# SYS\_FS\_DirSearch Function

**Parent topic:**[Library Interface](GUID-42556FDF-A632-49FE-8A5E-9303A926578C.md)

## C

```c
SYS_FS_RESULT SYS_FS_DirSearch
(
    SYS_FS_HANDLE handle,
    const char * name,
    SYS_FS_FILE_DIR_ATTR attr,
    SYS_FS_FSTAT *stat
);
```

## Summary

Searches for a file or directory.

## Description

This function searches for the requested file or directory. The file or<br />directory is specified in the attr parameter, which is of type<br />SYS\_FS\_FILE\_DIR\_ATTR.

The file system supports 8.3 file name\(Short File Name\) and<br />also long file name. 8.3 filenames are limited to at most eight<br />characters, followed optionally by a filename extension<br />consisting of a period . and at most three further characters.<br />If the file name fits within the 8.3 limits then generally<br />there will be no valid LFN for it.

**For FAT File system**

-   If LFN is used the stat structure's altname field<br />will contain the short file name and fname will contain the long file name.<br />The "lfname" member of the SYS\_FS\_FSTAT is not applicable for FAT. It has to be<br />initialized to NULL before calling the API. If "lfname" is not NULL, then<br />first byte of lfname will be set to zero indicating no file found.


**For other File systems based on thier implementation**<br />-If LFN is used then the "lfname" member of the SYS\_FS\_FSTAT structure should be<br />initialized with the address of a suitable buffer and the "lfsize"<br />should be initialized with the size of the buffer. Once the function<br />returns, the buffer whose address is held in "lfname" will have<br />the file name\(long file name\).

-   The stat structure's fname field will contain the SFN and if<br />there is a valid LFN entry for the file then the long file name<br />will be copied into lfname member of the structure.


## Precondition

A valid directory handle must be obtained before searching the directory.

## Parameters

|Param|Description|
|-----|-----------|
|handle|directory handle obtained during directory open.|
|name|name of file or directory needed to be searched. The file name can have wild card entries as follows:|
|\*|Indicates the rest of the filename or extension can vary \(e.g. FILE.\*\)|
|?|Indicates that one character in a filename can vary \(e.g. F?LE.T?T\)|
|attr|Attribute of the name of type SYS\_FS\_FILE\_DIR\_ATTR. This attribute specifies whether to search a file or a directory. Other attribute types could also be specified.|
|stat|Pointer to SYS\_FS\_FSTAT, where the properties of the directory/file will be populated after the SYS\_FS\_DirSearch function returns successfully.|

## Returns

*SYS\_FS\_RES\_SUCCESS* - Indicates that the file or directory was found. The<br />stat parameter will contain information about the file or directory.

*SYS\_FS\_RES\_FAILURE* - Indicates that the file or directory was not found.<br />The reason for the failure can be retrieved with SYS\_FS\_Error or SYS\_FS\_FileError.

## Example

```c
SYS_FS_HANDLE dirHandle;
SYS_FS_FSTAT stat;

dirHandle = SYS_FS_DirOpen("/mnt/myDrive/Dir1");

if(dirHandle != SYS_FS_HANDLE_INVALID)
{
    // Directory open is successful
}

if(SYS_FS_DirSearch(dirHandle, "FIL*.*", SYS_FS_ATTR_ARC, &stat) == SYS_FS_RES_FAILURE)
{
    // Specified file not found or reached end of directory
}
else
{
    // File found. Read the complete file name from "stat.fname" or "stat.lfname" and
    // other file parameters from the "stat" structure
}
```

## Remarks

None.

