<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="SYS_FS_EventHandlerSet Function" />
<meta name="DC.relation" scheme="URI" content="GUID-42556FDF-A632-49FE-8A5E-9303A926578C.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="sys-fs-eventhandlerset-function" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>SYS_FS_EventHandlerSet Function</title>
<meta name="Microsoft.Help.Id" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF-sys-fs-eventhandlerset-function" />
<meta name="Microsoft.Help.TocParent" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Core Library Reference A 11/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-760611CB-BB7F-4083-A98D-102D8A28E346"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="sys-fs-eventhandlerset-function">
<h1 class="title topictitle1" id="ariaid-title1">SYS_FS_EventHandlerSet Function</h1><div class="body"></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-42556FDF-A632-49FE-8A5E-9303A926578C.html">Library Interface</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d91843e21', this);">Copy</button><code id="d91843e21" content="void SYS_FS_EventHandlerSet&#xA;(&#xA;    const void * eventHandler,&#xA;    const uintptr_t context&#xA;);"><span class="ph token keyword">void</span> SYS_FS_EventHandlerSet
<span class="ph token punctuation">(</span>
    <span class="ph token keyword">const</span> <span class="ph token keyword">void</span> <span class="ph token operator">*</span> eventHandler<span class="ph token punctuation">,</span>
    <span class="ph token keyword">const</span> uintptr_t context
<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="summary"><h2 class="title topictitle2" id="ariaid-title3">Summary</h2><div class="body"><p class="p">Sets the pointer to the function (and it's context) to be called when mount/unmount event has occurred</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="description"><h2 class="title topictitle2" id="ariaid-title4">Description</h2><div class="body"><p class="p">This function allows a client to identify an event handling function for
the File System to call back when mount/unmount operation has completed.</p>
<p class="p">The file system will pass mount name back to the client by calling
"eventHandler" when AutoMount feature is enabled for File system.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="precondition"><h2 class="title topictitle2" id="ariaid-title5">Precondition</h2><div class="body"><p class="p">The SYS_FS_Initialize() routine must have been called.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title6" id="parameters"><h2 class="title topictitle2" id="ariaid-title6">Parameters</h2><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d91843e78"><span>Param</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d91843e80"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d91843e78 "><span>eventHandler</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d91843e80 "><span>Pointer to the event handler function implemented by the user</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d91843e78 "><span>context</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d91843e80 "><span>The value of parameter will be passed back to the client unchanged, when the eventHandler function is called. It can be used to identify any client specific data object that identifies the instance of the client module (for example, it may be a pointer to the client module's state structure).</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title7" id="returns"><h2 class="title topictitle2" id="ariaid-title7">Returns</h2><div class="body"><p class="p">None.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title8" id="example"><h2 class="title topictitle2" id="ariaid-title8">Example</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d91843e103', this);">Copy</button><code id="d91843e103" content="// Client registers an event handler with file system. This is done once.&#xA;SYS_FS_EventHandlerSet(APP_SysFSEventHandler, (uintptr_t)NULL);&#xA;&#xA;// Event Processing Technique. Event is received when operation is done.&#xA;void APP_SysFSEventHandler&#xA;(&#xA;    SYS_FS_EVENT event,&#xA;    void* eventData,&#xA;    uintptr_t context&#xA;)&#xA;{&#xA;    switch(event)&#xA;    {&#xA;        case SYS_FS_EVENT_MOUNT:&#xA;        {&#xA;            if(strcmp((const char *)eventData,&#34;/mnt/myDrive1&#34;) == 0)&#xA;            {&#xA;                gSDCardMountFlag = true;&#xA;            }&#xA;            else if(strcmp((const char *)eventData,&#34;/mnt/myDrive2&#34;) == 0)&#xA;            {&#xA;                gNVMMountFlag = true;&#xA;            }&#xA;            break;&#xA;        }&#xA;&#xA;        case SYS_FS_EVENT_MOUNT_WITH_NO_FILESYSTEM:&#xA;        {&#xA;            if(strcmp((const char *)eventData,&#34;/mnt/myDrive1&#34;) == 0)&#xA;            {&#xA;                gSDCardFormatRequired = true;&#xA;            }&#xA;            else if(strcmp((const char *)eventData,&#34;/mnt/myDrive2&#34;) == 0)&#xA;            {&#xA;                gNVMFormatRequired = true;&#xA;            }&#xA;            break;&#xA;        }&#xA;&#xA;        case SYS_FS_EVENT_UNMOUNT:&#xA;        {&#xA;            if(strcmp((const char *)eventData,&#34;/mnt/myDrive1&#34;) == 0)&#xA;            {&#xA;                gSDCardMountFlag = false;&#xA;            }&#xA;            else if(strcmp((const char *)eventData,&#34;/mnt/myDrive2&#34;) == 0)&#xA;            {&#xA;                gNVMMountFlag = false;&#xA;            }&#xA;            break;&#xA;        }&#xA;&#xA;        case SYS_FS_EVENT_ERROR:&#xA;        default:&#xA;        {&#xA;            break;&#xA;        }&#xA;    }&#xA;}"><span class="ph token comment">// Client registers an event handler with file system. This is done once.</span>
<span class="ph token function">SYS_FS_EventHandlerSet</span><span class="ph token punctuation">(</span>APP_SysFSEventHandler<span class="ph token punctuation">,</span> <span class="ph token punctuation">(</span>uintptr_t<span class="ph token punctuation">)</span><span class="ph token constant">NULL</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token comment">// Event Processing Technique. Event is received when operation is done.</span>
<span class="ph token keyword">void</span> APP_SysFSEventHandler
<span class="ph token punctuation">(</span>
    SYS_FS_EVENT event<span class="ph token punctuation">,</span>
    <span class="ph token keyword">void</span><span class="ph token operator">*</span> eventData<span class="ph token punctuation">,</span>
    uintptr_t context
<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token keyword">switch</span><span class="ph token punctuation">(</span>event<span class="ph token punctuation">)</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token keyword">case</span> SYS_FS_EVENT_MOUNT<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">strcmp</span><span class="ph token punctuation">(</span><span class="ph token punctuation">(</span><span class="ph token keyword">const</span> <span class="ph token keyword">char</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span>eventData<span class="ph token punctuation">,</span><span class="ph token string">"/mnt/myDrive1"</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> <span class="ph token number">0</span><span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                gSDCardMountFlag <span class="ph token operator">=</span> true<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">else</span> <span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">strcmp</span><span class="ph token punctuation">(</span><span class="ph token punctuation">(</span><span class="ph token keyword">const</span> <span class="ph token keyword">char</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span>eventData<span class="ph token punctuation">,</span><span class="ph token string">"/mnt/myDrive2"</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> <span class="ph token number">0</span><span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                gNVMMountFlag <span class="ph token operator">=</span> true<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>

        <span class="ph token keyword">case</span> SYS_FS_EVENT_MOUNT_WITH_NO_FILESYSTEM<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">strcmp</span><span class="ph token punctuation">(</span><span class="ph token punctuation">(</span><span class="ph token keyword">const</span> <span class="ph token keyword">char</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span>eventData<span class="ph token punctuation">,</span><span class="ph token string">"/mnt/myDrive1"</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> <span class="ph token number">0</span><span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                gSDCardFormatRequired <span class="ph token operator">=</span> true<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">else</span> <span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">strcmp</span><span class="ph token punctuation">(</span><span class="ph token punctuation">(</span><span class="ph token keyword">const</span> <span class="ph token keyword">char</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span>eventData<span class="ph token punctuation">,</span><span class="ph token string">"/mnt/myDrive2"</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> <span class="ph token number">0</span><span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                gNVMFormatRequired <span class="ph token operator">=</span> true<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>

        <span class="ph token keyword">case</span> SYS_FS_EVENT_UNMOUNT<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">strcmp</span><span class="ph token punctuation">(</span><span class="ph token punctuation">(</span><span class="ph token keyword">const</span> <span class="ph token keyword">char</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span>eventData<span class="ph token punctuation">,</span><span class="ph token string">"/mnt/myDrive1"</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> <span class="ph token number">0</span><span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                gSDCardMountFlag <span class="ph token operator">=</span> false<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">else</span> <span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">strcmp</span><span class="ph token punctuation">(</span><span class="ph token punctuation">(</span><span class="ph token keyword">const</span> <span class="ph token keyword">char</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span>eventData<span class="ph token punctuation">,</span><span class="ph token string">"/mnt/myDrive2"</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> <span class="ph token number">0</span><span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                gNVMMountFlag <span class="ph token operator">=</span> false<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>

        <span class="ph token keyword">case</span> SYS_FS_EVENT_ERROR<span class="ph token operator">:</span>
        <span class="ph token keyword">default</span><span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>
    <span class="ph token punctuation">}</span>
<span class="ph token punctuation">}</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title9" id="remarks"><h2 class="title topictitle2" id="ariaid-title9">Remarks</h2><div class="body"><p class="p">On Mount/Un-Mount of a volume all the registered clients will be notified.  The client should check if the mount name passed when event handler is called is the one it is expecting and then proceed as demonstrated in above example.  If the client does not want to be notified when the mount/unmount operation has completed, it does not need to register a callback.  Note: This API is Available only when SYS_FS_AUTOMOUNT_ENABLE is set to true.</p>
</div>
</div>
</body>
</html>