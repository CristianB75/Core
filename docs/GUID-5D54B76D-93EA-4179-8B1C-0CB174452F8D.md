# DRV\_I2C\_WriteTransferAdd Function

**Parent topic:**[Library Interface](GUID-5A5146D2-73C2-43B1-8ADE-95E0184AF1A5.md)

## C

```c
void DRV_I2C_WriteTransferAdd(
    const DRV_HANDLE handle,
    const uint16_t address,
    void * const buffer,
    const size_t size,
    DRV_I2C_TRANSFER_HANDLE * const transferHandle
)
```

## Summary

Queues a write operation.

## Description

This function schedules a non-blocking write operation. The function returns<br />with a valid transfer handle in the transferHandle argument if the write<br />request was scheduled successfully. The function adds the request to the<br />driver instance transfer queue and returns immediately. While the request is<br />in the queue, the application buffer is owned by the driver and should not be<br />modified.

On returning, the transferHandle parameter may be<br />DRV\_I2C\_TRANSFER\_HANDLE\_INVALID for the following reasons:

-   if a transfer buffer could not be allocated to the request

-   if the input buffer pointer is NULL

-   if the buffer size is 0


If the requesting client registered an event callback with the driver, the<br />driver will issue a DRV\_I2C\_TRANSFER\_EVENT\_COMPLETE event if the buffer was<br />processed successfully or a DRV\_I2C\_TRANSFER\_EVENT\_ERROR event if the buffer<br />was not processed successfully.

## Precondition

DRV\_I2C\_Open must have been called to obtain a valid opened device handle.

## Parameters

|Param|Description|
|-----|-----------|
|handle|A valid open-instance handle, returned from the driver's open routine DRV\_I2C\_Open function.|
|address|Slave address|
|buffer|Data to be written.|
|size|Transfer size in bytes.|
|transferHandle|Pointer to an argument that will contain the return transfer handle. This will be DRV\_I2C\_TRANSFER\_HANDLE\_INVALID if the function was not successful.|

## Returns

None.

## Example

```c
uint8_t myBuffer[MY_BUFFER_SIZE];
DRV_I2C_TRANSFER_HANDLE transferHandle;

// myI2CHandle is the handle returned
// by the DRV_I2C_Open function.

// slaveAddress is address of I2C slave device
// to which data is to be written

DRV_I2C_WriteTransferAdd(myI2CHandle, slaveAddress, myBuffer, MY_BUFFER_SIZE, &transferHandle);

if(transferHandle == DRV_I2C_TRANSFER_HANDLE_INVALID)
{
    // Error handling here
}

// Event is received when the buffer is processed.
```

## Remarks

This function is thread safe in a RTOS application. It can be called from within the I2C Driver Transfer Event Handler that is registered by this client. It should not be called in the event handler associated with another I2C driver instance. It should not otherwise be called directly in an ISR. This function is available only in the asynchronous mode.

