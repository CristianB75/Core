<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="SYS_FS_DirRead Function" />
<meta name="DC.relation" scheme="URI" content="GUID-42556FDF-A632-49FE-8A5E-9303A926578C.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="sys-fs-dirread-function" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>SYS_FS_DirRead Function</title>
<meta name="Microsoft.Help.Id" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF-sys-fs-dirread-function" />
<meta name="Microsoft.Help.TocParent" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Core Library Reference A 11/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-C43ABFE3-58B7-4A30-840E-B2BBCCCDF33D"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="sys-fs-dirread-function">
<h1 class="title topictitle1" id="ariaid-title1">SYS_FS_DirRead Function</h1><div class="body"></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-42556FDF-A632-49FE-8A5E-9303A926578C.html">Library Interface</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d95756e21', this);">Copy</button><code id="d95756e21" content="SYS_FS_RESULT SYS_FS_DirRead&#xA;(&#xA;SYS_FS_HANDLE handle,&#xA;SYS_FS_FSTAT *stat&#xA;);">SYS_FS_RESULT SYS_FS_DirRead
<span class="ph token punctuation">(</span>
SYS_FS_HANDLE handle<span class="ph token punctuation">,</span>
SYS_FS_FSTAT <span class="ph token operator">*</span>stat
<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="summary"><h2 class="title topictitle2" id="ariaid-title3">Summary</h2><div class="body"><p class="p">Reads the files and directories of the specified directory.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="description"><h2 class="title topictitle2" id="ariaid-title4">Description</h2><div class="body"><p class="p">This function reads the files and directories specified in the open
directory.</p>
<p class="p">The file system supports 8.3 file name(Short File Name) and
also long file name. 8.3 filenames are limited to at most eight
characters, followed optionally by a filename extension
consisting of a period . and at most three further characters.
If the file name fits within the 8.3 limits then generally
there will be no valid LFN for it.</p>
<p class="p"><strong class="ph b">For FAT File system</strong></p>
<ul class="ul"><li class="li"><p class="p">If LFN is used the stat structure's altname field
will contain the short file name and fname will contain the long file name.
The "lfname" member of the SYS_FS_FSTAT is not applicable for FAT. It has to be
initialized to NULL before calling the API. If "lfname" is not NULL, then
first byte of lfname will be set to zero indicating no file found.</p>
</li>
</ul>
<p class="p"><strong class="ph b">For other File systems based on thier implementation</strong>
-If LFN is used then the "lfname" member of the SYS_FS_FSTAT structure should be
initialized with the address of a suitable buffer and the "lfsize"
should be initialized with the size of the buffer. Once the function
returns, the buffer whose address is held in "lfname" will have
the file name(long file name).</p>
<ul class="ul"><li class="li"><p class="p">The stat structure's fname field will contain the SFN and if
there is a valid LFN entry for the file then the long file name
will be copied into lfname member of the structure.</p>
</li>
</ul>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="precondition"><h2 class="title topictitle2" id="ariaid-title5">Precondition</h2><div class="body"><p class="p">A valid directory handle must be obtained before reading a directory.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title6" id="parameters"><h2 class="title topictitle2" id="ariaid-title6">Parameters</h2><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d95756e81"><span>Param</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d95756e83"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d95756e81 "><span>handle</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d95756e83 "><span>Directory handle obtained during directory open.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d95756e81 "><span>stat</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d95756e83 "><span>Pointer to SYS_FS_FSTAT, where the properties of the open directory will be populated after the SYS_FS_DirRead function returns successfully.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title7" id="returns"><h2 class="title topictitle2" id="ariaid-title7">Returns</h2><div class="body"><p class="p"><em class="ph i">SYS_FS_RES_SUCCESS</em> - Indicates that the directory read operation was
successful. End of the directory condition is indicated by setting the fname and lfname(if lfname is used) fields of the SYS_FS_FSTAT structure to '\0'</p>
<p class="p"><em class="ph i">SYS_FS_RES_FAILURE</em> - Indicates that the directory read operation was
unsuccessful. The reason for the failure can be retrieved with SYS_FS_Error or SYS_FS_FileError.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title8" id="example"><h2 class="title topictitle2" id="ariaid-title8">Example</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d95756e112', this);">Copy</button><code id="d95756e112" content="// For FAT File System&#xA;&#xA;SYS_FS_HANDLE dirHandle;&#xA;SYS_FS_FSTAT stat;&#xA;&#xA;dirHandle = SYS_FS_DirOpen(&#34;/mnt/myDrive/Dir1&#34;);&#xA;&#xA;if(dirHandle != SYS_FS_HANDLE_INVALID)&#xA;{&#xA;    // Directory open is successful&#xA;}&#xA;&#xA;if(SYS_FS_DirRead(dirHandle, &amp;stat) == SYS_FS_RES_FAILURE)&#xA;{&#xA;    // Directory read failed.&#xA;}&#xA;else&#xA;{&#xA;    // Directory read succeeded.&#xA;    if (stat.fname[0] == '\0')&#xA;    {&#xA;        // reached the end of the directory.&#xA;    }&#xA;    else&#xA;    {&#xA;        // continue reading the directory.&#xA;    }&#xA;    &#xA;}"><span class="ph token comment">// For FAT File System</span>

SYS_FS_HANDLE dirHandle<span class="ph token punctuation">;</span>
SYS_FS_FSTAT stat<span class="ph token punctuation">;</span>

dirHandle <span class="ph token operator">=</span> <span class="ph token function">SYS_FS_DirOpen</span><span class="ph token punctuation">(</span><span class="ph token string">"/mnt/myDrive/Dir1"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">if</span><span class="ph token punctuation">(</span>dirHandle <span class="ph token operator">!=</span> SYS_FS_HANDLE_INVALID<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// Directory open is successful</span>
<span class="ph token punctuation">}</span>

<span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">SYS_FS_DirRead</span><span class="ph token punctuation">(</span>dirHandle<span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>stat<span class="ph token punctuation">)</span> <span class="ph token operator">==</span> SYS_FS_RES_FAILURE<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// Directory read failed.</span>
<span class="ph token punctuation">}</span>
<span class="ph token keyword">else</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// Directory read succeeded.</span>
    <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span>stat<span class="ph token punctuation">.</span>fname<span class="ph token punctuation">[</span><span class="ph token number">0</span><span class="ph token punctuation">]</span> <span class="ph token operator">==</span> <span class="ph token string">'\0'</span><span class="ph token punctuation">)</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token comment">// reached the end of the directory.</span>
    <span class="ph token punctuation">}</span>
    <span class="ph token keyword">else</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token comment">// continue reading the directory.</span>
    <span class="ph token punctuation">}</span>
    
<span class="ph token punctuation">}</span></code></pre><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d95756e252', this);">Copy</button><code id="d95756e252" content="// For other File Systems with LFN support&#xA;&#xA;SYS_FS_HANDLE dirHandle;&#xA;SYS_FS_FSTAT stat;&#xA;&#xA;char CACHE_ALIGN longFileName[512];&#xA;&#xA;dirHandle = SYS_FS_DirOpen(&#34;/mnt/myDrive/Dir1&#34;);&#xA;&#xA;if(dirHandle != SYS_FS_HANDLE_INVALID)&#xA;{&#xA;    // Directory open is successful&#xA;}&#xA;&#xA;// If long file name is used, the following elements of the &#34;stat&#34;&#xA;// structure needs to be initialized with address of proper buffer.&#xA;stat.lfname = longFileName;&#xA;stat.lfsize = 512;&#xA;&#xA;if(SYS_FS_DirRead(dirHandle, &amp;stat) == SYS_FS_RES_FAILURE)&#xA;{&#xA;    // Directory read failed.&#xA;}&#xA;else&#xA;{&#xA;    // Directory read succeeded.&#xA;    if ((stat.lfname[0] == '\0') &amp;&amp; (stat.fname[0] == '\0'))&#xA;    {&#xA;        // reached the end of the directory.&#xA;    }&#xA;    else&#xA;    {&#xA;        // continue reading the directory.&#xA;    }&#xA;    &#xA;}"><span class="ph token comment">// For other File Systems with LFN support</span>

SYS_FS_HANDLE dirHandle<span class="ph token punctuation">;</span>
SYS_FS_FSTAT stat<span class="ph token punctuation">;</span>

<span class="ph token keyword">char</span> CACHE_ALIGN longFileName<span class="ph token punctuation">[</span><span class="ph token number">512</span><span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>

dirHandle <span class="ph token operator">=</span> <span class="ph token function">SYS_FS_DirOpen</span><span class="ph token punctuation">(</span><span class="ph token string">"/mnt/myDrive/Dir1"</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">if</span><span class="ph token punctuation">(</span>dirHandle <span class="ph token operator">!=</span> SYS_FS_HANDLE_INVALID<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// Directory open is successful</span>
<span class="ph token punctuation">}</span>

<span class="ph token comment">// If long file name is used, the following elements of the "stat"</span>
<span class="ph token comment">// structure needs to be initialized with address of proper buffer.</span>
stat<span class="ph token punctuation">.</span>lfname <span class="ph token operator">=</span> longFileName<span class="ph token punctuation">;</span>
stat<span class="ph token punctuation">.</span>lfsize <span class="ph token operator">=</span> <span class="ph token number">512</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">SYS_FS_DirRead</span><span class="ph token punctuation">(</span>dirHandle<span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>stat<span class="ph token punctuation">)</span> <span class="ph token operator">==</span> SYS_FS_RES_FAILURE<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// Directory read failed.</span>
<span class="ph token punctuation">}</span>
<span class="ph token keyword">else</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// Directory read succeeded.</span>
    <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token punctuation">(</span>stat<span class="ph token punctuation">.</span>lfname<span class="ph token punctuation">[</span><span class="ph token number">0</span><span class="ph token punctuation">]</span> <span class="ph token operator">==</span> <span class="ph token string">'\0'</span><span class="ph token punctuation">)</span> <span class="ph token operator">&amp;&amp;</span> <span class="ph token punctuation">(</span>stat<span class="ph token punctuation">.</span>fname<span class="ph token punctuation">[</span><span class="ph token number">0</span><span class="ph token punctuation">]</span> <span class="ph token operator">==</span> <span class="ph token string">'\0'</span><span class="ph token punctuation">)</span><span class="ph token punctuation">)</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token comment">// reached the end of the directory.</span>
    <span class="ph token punctuation">}</span>
    <span class="ph token keyword">else</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token comment">// continue reading the directory.</span>
    <span class="ph token punctuation">}</span>
    
<span class="ph token punctuation">}</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title9" id="remarks"><h2 class="title topictitle2" id="ariaid-title9">Remarks</h2><div class="body"><p class="p">None.</p>
</div>
</div>
</body>
</html>