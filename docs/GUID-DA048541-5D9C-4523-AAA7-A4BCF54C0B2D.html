<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="How the Library Works" />
<meta name="DC.relation" scheme="URI" content="GUID-066D09D2-5550-49D9-ADA2-60A702DB243E.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="how-the-library-works" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>How the Library Works</title>
<meta name="Microsoft.Help.Id" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF-how-the-library-works" />
<meta name="Microsoft.Help.TocParent" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Core Library Reference A 11/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-DA048541-5D9C-4523-AAA7-A4BCF54C0B2D"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="how-the-library-works">
<h1 class="title topictitle1" id="ariaid-title1">How the Library Works</h1><div class="body"><p class="p">The MPLAB Harmony File System Service (SYS_FS) provides embedded application developers with a file system framework for retrieving and storing data from various media.</p>
<p class="p">The File System Service abstracts the native file system calls and provides a common interface to the user/application layer. For example, while the application layer requests for a file read or write from a disk, due to the presence of the this abstraction, the application need not be bothered about the native file system implemented on that disk. Instead, the application can call the read/write API of the File System service, which in turn translates to the read/write command of the native file system used on the required disk.</p>
<p class="p">This simplifies the implementation of the higher application layer and also provides a mechanism to add more native file system to the File System framework in the future.</p>
<p class="p"><strong class="ph b">Abstraction Model</strong></p>
<p class="p">The File System framework features a modular and layered architecture, as shown in the following figure.</p>
<br /><img class="image" src="GUID-3570155B-7746-4C60-AB0F-8CA5498871CD-low.png" alt="sys_fs_abstraction_model" /><br /><ul class="ul"><li class="li"><p class="p">The <strong class="ph b">Media Block Driver</strong> for the physical media has to be included as a part of the FS Framework.</p>
<ul class="ul"><li class="li"><p class="p">This layer provides a mechanism to access the media as "sectors". Sectors are the smallest storage element accessed by a file system and are contiguous memory locations. Typically, each sector has 512 bytes.</p>
</li>
<li class="li"><p class="p">It can directly provide low-level interface to access the physical media or an interface to access the intermediate media device drivers.</p>
</li>
<li class="li"><p class="p">This layer also enables multiple instances of media. It depends on below drivers for accessing the media</p>
<ul class="ul"><li class="li"><p class="p">Memory Driver if media is NVM, SPI/QSPI Flash, SPI/I2C EEPROM, RAM</p>
</li>
<li class="li"><p class="p">SDMMC or SDSPI Driver if media is a SD Card or eMMC</p>
</li>
<li class="li"><p class="p">USB Host MSD driver if media is a USB thumb drive</p>
</li>
</ul>
</li>
</ul>
</li>
<li class="li"><p class="p">The <strong class="ph b">Media manager</strong> implements a disk and sector based media access mechanism. It also performs disk allocate/deallocate on media attach/detach events. Due to the implementation of this layer, the FS Framework can support multiple disks.</p>
<ul class="ul"><li class="li"><p class="p">The media manager detects and analyzes a media based on its Master Boot Record (MBR). Therefore, it is mandatory for the media to have a MBR for it to work with the FS.</p>
</li>
</ul>
</li>
<li class="li"><p class="p">The <strong class="ph b">Native file system</strong> implements support for the media file system format. Below are the examples of native file systems currently supported. However, more native file systems can be included.</p>
<ul class="ul"><li class="li"><p class="p">FAT12, FAT16, FAT32 and exFAT</p>
</li>
<li class="li"><p class="p">MPFS</p>
</li>
<li class="li"><p class="p">littleFS</p>
</li>
</ul>
</li>
<li class="li"><p class="p">The <strong class="ph b">Virtual file system (or SYS_FS )</strong> layer provides a file system independent file system operation interface. This layer translates virtual file systems calls to native file system calls. Due to this layer, applications can now support multiple file systems. Commonly used interfaces provided by this layer, but not limited to, include:</p>
<ul class="ul"><li class="li"><p class="p">SYS_FS_mount</p>
</li>
<li class="li"><p class="p">SYS_FS_unmount</p>
</li>
<li class="li"><p class="p">SYS_FS_open</p>
</li>
<li class="li"><p class="p">SYS_FS_read</p>
</li>
<li class="li"><p class="p">SYS_FS_write</p>
</li>
<li class="li"><p class="p">SYS_FS_close</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-066D09D2-5550-49D9-ADA2-60A702DB243E.html">File System Service</a></div>
</div>
</div></body>
</html>