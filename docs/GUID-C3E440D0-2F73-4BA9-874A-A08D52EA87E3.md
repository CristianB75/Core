# SYS\_FS\_Mount Function

**Parent topic:**[Library Interface](GUID-42556FDF-A632-49FE-8A5E-9303A926578C.md)

## C

```c
SYS_FS_RESULT SYS_FS_Mount
(
    const char *devName,
    const char *mountName,
    SYS_FS_FILE_SYSTEM_TYPE filesystemtype,
    unsigned long mountflags,
    const void *data
);
```

## Summary

Mounts the disk/volume with specified file system.

## Description

The mount command attaches the file system specified to a volume. The<br />call to the mount should be non blocking in nature. The application code<br />has to allow the SYS\_FS\_Tasks to run periodically while calling the<br />SYS\_FS\_Mount function.

If the SYS\_FS\_Mount is called in a blocking mode, then the SYS\_FS\_Tasks\(\)<br />never gets a chance to run and therefore, the media will not be analyzed<br />and finally, the SYS\_FS\_Mount will never succeed. This will result in a deadlock.

There is no mechanism available for the application to know if the<br />specified volume \(devName\) is really attached or not. The only available<br />possibility is to keep trying to mount the volume \(with the devname\),<br />until success is achieved or use the Automount feature.

It is prudent that the application code implements a time-out mechanism<br />while trying to mount a volume \(by calling SYS\_FS\_Mount\). The trial for<br />mount should continue at least 10 times before assuming that the<br />mount will never succeed. This has to be done for every new volume to be<br />mounted.

Once the mount is successful the application needs to use SYS\_FS\_Error\(\)<br />API to know if the mount was successful with valid filesystem on media<br />or not. If SYS\_FS\_ERROR\_NO\_FILESYSTEM is returned application needs to<br />Format the media using the SYS\_FS\_DriveFormat\(\) API before performing<br />any operations.

The standard names for volumes \(devName\) used in the MPLAB Harmony file<br />system is as follows:

-   NVM - "nvm" "media number" "volume number"

-   SD card - "mmcblk" "media number" "volume number"

-   MSD - "sd" "media number" "volume number"

-   Flash - "mtd" "media number" "volume number"


Where,

-   "media number" a, b, c... depends on the number of the type of connected media

-   "volume number" 1, 2, 3... depends on the number of partitions in that media.


The convention for assigning names to volumes is further described below<br />with examples:

If a SD card \(with four partitions\) is attached to the system, and<br />assuming all four partitions are recognized, there will be four devNames:

-   mmcblka1

-   mmcblka2

-   mmcblka3 and

-   mmcblka4


Subsequently, if NVM media is attached that has only one partition, the<br />devname will be: **nvma1.**

Later, if another SD card is attached to the system that has one<br />partition, the devname will be **mmcblkb1.**

Finally, there will be six volume names \(or devNames\), which are<br />available for the application to be mounted and used for the file system.

## Precondition

The "devName" name for the volume has to be known. The file system type with which each of the volumes are formatted has to be known.

Trying to mount a volume with a file system which is different from what the volume is actually formatted, will cause mount failure.

## Parameters

|Param|Description|
|-----|-----------|
|devName|The device name \(name of volume\) which needs to be mounted. The devName has to be preceded by the string "/dev/".|
|mountName|Mount name for the device to be mounted. This is a name provided by the user. In future, while accessing the mounted volume \(say, during SYS\_FS\_FileOpen operation\), the mountName is used to refer the path for file. The mount name has to be preceded by the string "/mnt/"|
|filesystemtype|Native file system of SYS\_FS\_FILE\_SYSTEM\_TYPE type.|
|mountflags|Mounting control flags. This parameter is reserved for future enhancements. Therefore, always pass zero.|
|data|The data argument is interpreted by the different file systems. This parameter is reserved for future enhancements. Therefore, always pass NULL.|

## Returns

*SYS\_FS\_RES\_SUCCESS* - Mount was successful.

*SYS\_FS\_RES\_FAILURE* - Mount was unsuccessful. The reason for the failure<br />can be retrieved with SYS\_FS\_Error.

## Example

```c
switch(appState)
{
    case TRY_MOUNT:
    {
        if(SYS_FS_Mount("/dev/mmcblka1", "/mnt/myDrive", FAT, 0, NULL) != SYS_FS_RES_SUCCESS)
        {
            // Failure, try mounting again
        }
        else
        {
            // Mount was successful. Check for File System

            if (SYS_FS_Error() == SYS_FS_ERROR_NO_FILESYSTEM)
            {
                //Perform Driver Format operation as there is no filesystem on media
                SYS_FS_DriveFormat(...);
            }

            appState = DO_FURTHER_STUFFS;
        }
    }
    break;
}
```

## Remarks

None

