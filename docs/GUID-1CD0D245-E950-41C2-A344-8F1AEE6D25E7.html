<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="DRV_I2C_WriteReadTransferAdd Function" />
<meta name="DC.relation" scheme="URI" content="GUID-5A5146D2-73C2-43B1-8ADE-95E0184AF1A5.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="drv-i2c-writereadtransferadd-function" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>DRV_I2C_WriteReadTransferAdd Function</title>
<meta name="Microsoft.Help.Id" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF-drv-i2c-writereadtransferadd-function" />
<meta name="Microsoft.Help.TocParent" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Core Library Reference A 11/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-1CD0D245-E950-41C2-A344-8F1AEE6D25E7"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="drv-i2c-writereadtransferadd-function">
<h1 class="title topictitle1" id="ariaid-title1">DRV_I2C_WriteReadTransferAdd Function</h1><div class="body"></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-5A5146D2-73C2-43B1-8ADE-95E0184AF1A5.html">Library Interface</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d45314e21', this);">Copy</button><code id="d45314e21" content="void DRV_I2C_WriteReadTransferAdd (&#xA;    const DRV_HANDLE handle,&#xA;    const uint16_t address,&#xA;    void * const writeBuffer,&#xA;    const size_t writeSize,&#xA;    void * const readBuffer,&#xA;    const size_t readSize,&#xA;    DRV_I2C_TRANSFER_HANDLE * const transferHandle&#xA;)"><span class="ph token keyword">void</span> DRV_I2C_WriteReadTransferAdd <span class="ph token punctuation">(</span>
    <span class="ph token keyword">const</span> DRV_HANDLE handle<span class="ph token punctuation">,</span>
    <span class="ph token keyword">const</span> uint16_t address<span class="ph token punctuation">,</span>
    <span class="ph token keyword">void</span> <span class="ph token operator">*</span> <span class="ph token keyword">const</span> writeBuffer<span class="ph token punctuation">,</span>
    <span class="ph token keyword">const</span> size_t writeSize<span class="ph token punctuation">,</span>
    <span class="ph token keyword">void</span> <span class="ph token operator">*</span> <span class="ph token keyword">const</span> readBuffer<span class="ph token punctuation">,</span>
    <span class="ph token keyword">const</span> size_t readSize<span class="ph token punctuation">,</span>
    DRV_I2C_TRANSFER_HANDLE <span class="ph token operator">*</span> <span class="ph token keyword">const</span> transferHandle
<span class="ph token punctuation">)</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="summary"><h2 class="title topictitle2" id="ariaid-title3">Summary</h2><div class="body"><p class="p">Queues a write followed by read operation.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="description"><h2 class="title topictitle2" id="ariaid-title4">Description</h2><div class="body"><p class="p">This function schedules a non-blocking write followed by read operation. The
function returns with a valid transfer handle in the transferHandle argument
if the write request was scheduled successfully. The function adds the request
to the driver instance transfer queue and returns immediately. While the
request is in the queue, the application buffer is owned by the driver and
should not be modified.</p>
<p class="p">On returning, the transferHandle parameter may be
DRV_I2C_TRANSFER_HANDLE_INVALID for the following reasons:</p>
<ul class="ul"><li class="li"><p class="p">if a buffer could not be allocated to the request</p>
</li>
<li class="li"><p class="p">if the input write or read buffer pointer is NULL</p>
</li>
<li class="li"><p class="p">if the write or read buffer size is 0</p>
</li>
</ul>
<p class="p">If the requesting client registered an event callback with the driver, the
driver will issue a DRV_I2C_TRANSFER_EVENT_COMPLETE event if the buffer was
processed successfully or a DRV_I2C_TRANSFER_EVENT_ERROR event if the buffer
was not processed successfully.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="precondition"><h2 class="title topictitle2" id="ariaid-title5">Precondition</h2><div class="body"><p class="p">DRV_I2C_Open must have been called to obtain a valid opened device handle.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title6" id="parameters"><h2 class="title topictitle2" id="ariaid-title6">Parameters</h2><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d45314e129"><span>Param</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d45314e131"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e129 "><span>handle</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e131 "><span>A valid open-instance handle, returned from the driver's open routine DRV_I2C_Open function.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e129 "><span>address</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e131 "><span>Slave address</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e129 "><span>writeBuffer</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e131 "><span>Data to be written.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e129 "><span>writeSize</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e131 "><span>Size of write buffer in bytes.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e129 "><span>readBuffer</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e131 "><span>Buffer where data to be read is stored.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e129 "><span>readSize</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e131 "><span>Size of the read buffer in bytes.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e129 "><span>transferHandle</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d45314e131 "><span>Pointer to an argument that will contain the return transfer handle. This will be DRV_I2C_TRANSFER_HANDLE_INVALID if the function was not successful.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title7" id="returns"><h2 class="title topictitle2" id="ariaid-title7">Returns</h2><div class="body"><p class="p">None.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title8" id="example"><h2 class="title topictitle2" id="ariaid-title8">Example</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d45314e179', this);">Copy</button><code id="d45314e179" content="uint8_t myTxBuffer[MY_TX_BUFFER_SIZE];&#xA;uint8_t myRxBuffer[MY_RX_BUFFER_SIZE];&#xA;DRV_I2C_TRANSFER_HANDLE transferHandle;&#xA;&#xA;// myI2CHandle is the handle returned&#xA;// by the DRV_I2C_Open function.&#xA;&#xA;// slaveAddress is address of I2C slave device&#xA;// to which data is to be written&#xA;&#xA;DRV_I2C_WriteReadTransferAdd(myI2CHandle, slaveAddress, myTxBuffer, MY_TX_BUFFER_SIZE, myRxBuffer, MY_RX_BUFFER_SIZE, &amp;transferHandle);&#xA;&#xA;if(transferHandle == DRV_I2C_TRANSFER_HANDLE_INVALID)&#xA;{&#xA;    // Error handling here&#xA;}&#xA;&#xA;// Event is received when the buffer is processed.">uint8_t myTxBuffer<span class="ph token punctuation">[</span>MY_TX_BUFFER_SIZE<span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>
uint8_t myRxBuffer<span class="ph token punctuation">[</span>MY_RX_BUFFER_SIZE<span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>
DRV_I2C_TRANSFER_HANDLE transferHandle<span class="ph token punctuation">;</span>

<span class="ph token comment">// myI2CHandle is the handle returned</span>
<span class="ph token comment">// by the DRV_I2C_Open function.</span>

<span class="ph token comment">// slaveAddress is address of I2C slave device</span>
<span class="ph token comment">// to which data is to be written</span>

<span class="ph token function">DRV_I2C_WriteReadTransferAdd</span><span class="ph token punctuation">(</span>myI2CHandle<span class="ph token punctuation">,</span> slaveAddress<span class="ph token punctuation">,</span> myTxBuffer<span class="ph token punctuation">,</span> MY_TX_BUFFER_SIZE<span class="ph token punctuation">,</span> myRxBuffer<span class="ph token punctuation">,</span> MY_RX_BUFFER_SIZE<span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>transferHandle<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">if</span><span class="ph token punctuation">(</span>transferHandle <span class="ph token operator">==</span> DRV_I2C_TRANSFER_HANDLE_INVALID<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// Error handling here</span>
<span class="ph token punctuation">}</span>

<span class="ph token comment">// Event is received when the buffer is processed.</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title9" id="remarks"><h2 class="title topictitle2" id="ariaid-title9">Remarks</h2><div class="body"><p class="p">This function is thread safe in a RTOS application. It can be called from within the I2C Driver Transfer Event Handler that is registered by this client. It should not be called in the event handler associated with another I2C driver instance. It should not otherwise be called directly in an ISR. This function is available only in the asynchronous mode.</p>
</div>
</div>
</body>
</html>