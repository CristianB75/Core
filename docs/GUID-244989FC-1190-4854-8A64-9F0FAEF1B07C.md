# DRV\_MEMORY\_AsyncErase Function

**Parent topic:**[Library Interface](GUID-E18B0923-4286-4E08-A2EB-9A482E0063AE.md)

## C

```c
void DRV_MEMORY_AsyncErase
(
    const DRV_HANDLE handle,
    DRV_MEMORY_COMMAND_HANDLE *commandHandle,
    uint32_t blockStart,
    uint32_t nBlock
);
```

## Summary

Erase the specified number of memory blocks in Asynchronous mode.

## Description

This function schedules a non-blocking sector erase operation for<br />the specified number of memory blocks from the specified block start<br />start address on attached memory device.

Each block is equal to sector size of the memory device attached.

The function returns with a valid erase handle in the commandHandle argument<br />if the erase request was scheduled successfully. The function adds the request<br />to the hardware instance queue and returns immediately.

The function returns DRV\_MEMORY\_COMMAND\_HANDLE\_INVALID in the commandHandle<br />argument under the following circumstances:

-   if a buffer object could not be allocated to the request

-   if the client opened the driver for read only

-   if the number of blocks to be erased is either zero or more than the number of blocks actually available

-   if the erase queue size is full or queue depth is insufficient

-   if the driver handle is invalid


If the requesting client registered a transfer handler callback with the<br />driver, It will issue a DRV\_MEMORY\_EVENT\_COMMAND\_COMPLETE event if the erase<br />operation was successful or DRV\_MEMORY\_EVENT\_COMMAND\_ERROR event if the<br />erase operation was not successful.

If the requesting client has not registered any transfer handler callback<br />with the driver, It can call DRV\_MEMORY\_CommandStatusGet\(\) API to know<br />the current status of the request.

## Preconditions

The DRV\_MEMORY\_Open\(\) must have been called with DRV\_IO\_INTENT\_WRITE or DRV\_IO\_INTENT\_READWRITE as a parameter to obtain a valid opened device handle.

## Parameters

|Param|Description|
|-----|-----------|
|handle|A valid open-instance handle, returned from the driver's open function|
|commandHandle|Pointer to an argument that will contain the return buffer handle|
|blockStart|Block start from where the blocks should be erased.|
|nBlock|Total number of blocks to be erased.|

## Returns

The command handle is returned in the commandHandle argument. It Will be DRV\_MEMORY\_COMMAND\_HANDLE\_INVALID if the request was not queued.

## Example

```c
// Use DRV_MEMORY_GeometryGet () to find the write region geometry.
uint32_t blockStart = 0;
uint32_t nBlocks = 10;
bool xfer_done = false;

// memoryHandle is the handle returned by the DRV_MEMORY_Open function.

// Event is received when the erase request is completed.
void appTransferHandler
(
    DRV_MEMORY_EVENT event,
    DRV_MEMORY_COMMAND_HANDLE commandHandle,
    uintptr_t context
)
{
    switch(event)
    {
        case DRV_MEMORY_EVENT_COMMAND_COMPLETE:
        {
            xfer_done = true;
            break;
        }

        case DRV_MEMORY_EVENT_COMMAND_ERROR:
        {
            // Handle Error
            break;
        }

        default:
        {
            break;
        }
    }
}

DRV_MEMORY_TransferHandlerSet(memoryHandle, appTransferHandler, (uintptr_t)NULL);

DRV_MEMORY_AsyncErase( memoryHandle, &commandHandle, blockStart, nBlocks );

if(DRV_MEMORY_COMMAND_HANDLE_INVALID == commandHandle)
{
    // Error handling here
}

// Wait for erase to be completed
while(!xfer_done);

```

## Remarks

This API is supported in Both Bare-Metal and RTOS environment.

