<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="SYS_FS_Mount Function" />
<meta name="DC.relation" scheme="URI" content="GUID-42556FDF-A632-49FE-8A5E-9303A926578C.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="sys-fs-mount-function" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>SYS_FS_Mount Function</title>
<meta name="Microsoft.Help.Id" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF-sys-fs-mount-function" />
<meta name="Microsoft.Help.TocParent" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Core Library Reference A 11/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-C3E440D0-2F73-4BA9-874A-A08D52EA87E3"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="sys-fs-mount-function">
<h1 class="title topictitle1" id="ariaid-title1">SYS_FS_Mount Function</h1><div class="body"></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-42556FDF-A632-49FE-8A5E-9303A926578C.html">Library Interface</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d150676e21', this);">Copy</button><code id="d150676e21" content="SYS_FS_RESULT SYS_FS_Mount&#xA;(&#xA;    const char *devName,&#xA;    const char *mountName,&#xA;    SYS_FS_FILE_SYSTEM_TYPE filesystemtype,&#xA;    unsigned long mountflags,&#xA;    const void *data&#xA;);">SYS_FS_RESULT SYS_FS_Mount
<span class="ph token punctuation">(</span>
    <span class="ph token keyword">const</span> <span class="ph token keyword">char</span> <span class="ph token operator">*</span>devName<span class="ph token punctuation">,</span>
    <span class="ph token keyword">const</span> <span class="ph token keyword">char</span> <span class="ph token operator">*</span>mountName<span class="ph token punctuation">,</span>
    SYS_FS_FILE_SYSTEM_TYPE filesystemtype<span class="ph token punctuation">,</span>
    <span class="ph token keyword">unsigned</span> <span class="ph token keyword">long</span> mountflags<span class="ph token punctuation">,</span>
    <span class="ph token keyword">const</span> <span class="ph token keyword">void</span> <span class="ph token operator">*</span>data
<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="summary"><h2 class="title topictitle2" id="ariaid-title3">Summary</h2><div class="body"><p class="p">Mounts the disk/volume with specified file system.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="description"><h2 class="title topictitle2" id="ariaid-title4">Description</h2><div class="body"><p class="p">The mount command attaches the file system specified to a volume. The
call to the mount should be non blocking in nature. The application code
has to allow the SYS_FS_Tasks to run periodically while calling the
SYS_FS_Mount function.</p>
<p class="p">If the SYS_FS_Mount is called in a blocking mode, then the SYS_FS_Tasks()
never gets a chance to run and therefore, the media will not be analyzed
and finally, the SYS_FS_Mount will never succeed. This will result in a deadlock.</p>
<p class="p">There is no mechanism available for the application to know if the
specified volume (devName) is really attached or not. The only available
possibility is to keep trying to mount the volume (with the devname),
until success is achieved or use the Automount feature.</p>
<p class="p">It is prudent that the application code implements a time-out mechanism
while trying to mount a volume (by calling SYS_FS_Mount). The trial for
mount should continue at least 10 times before assuming that the
mount will never succeed. This has to be done for every new volume to be
mounted.</p>
<p class="p">Once the mount is successful the application needs to use SYS_FS_Error()
API to know if the mount was successful with valid filesystem on media
or not. If SYS_FS_ERROR_NO_FILESYSTEM is returned application needs to
Format the media using the SYS_FS_DriveFormat() API before performing
any operations.</p>
<p class="p">The standard names for volumes (devName) used in the MPLAB Harmony file
system is as follows:</p>
<ul class="ul"><li class="li"><p class="p">NVM - "nvm" "media number" "volume number"</p>
</li>
<li class="li"><p class="p">SD card - "mmcblk" "media number" "volume number"</p>
</li>
<li class="li"><p class="p">MSD - "sd" "media number" "volume number"</p>
</li>
<li class="li"><p class="p">Flash - "mtd" "media number" "volume number"</p>
</li>
</ul>
<p class="p">Where,</p>
<ul class="ul"><li class="li"><p class="p">"media number" a, b, c... depends on the number of the type of connected media</p>
</li>
<li class="li"><p class="p">"volume number" 1, 2, 3... depends on the number of partitions in that media.</p>
</li>
</ul>
<p class="p">The convention for assigning names to volumes is further described below
with examples:</p>
<p class="p">If a SD card (with four partitions) is attached to the system, and
assuming all four partitions are recognized, there will be four devNames:</p>
<ul class="ul"><li class="li"><p class="p">mmcblka1</p>
</li>
<li class="li"><p class="p">mmcblka2</p>
</li>
<li class="li"><p class="p">mmcblka3 and</p>
</li>
<li class="li"><p class="p">mmcblka4</p>
</li>
</ul>
<p class="p">Subsequently, if NVM media is attached that has only one partition, the
devname will be: <strong class="ph b">nvma1.</strong></p>
<p class="p">Later, if another SD card is attached to the system that has one
partition, the devname will be <strong class="ph b">mmcblkb1.</strong></p>
<p class="p">Finally, there will be six volume names (or devNames), which are
available for the application to be mounted and used for the file system.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="precondition"><h2 class="title topictitle2" id="ariaid-title5">Precondition</h2><div class="body"><p class="p">The "devName" name for the volume has to be known. The file system type with which each of the volumes are formatted has to be known.</p>
<p class="p">Trying to mount a volume with a file system which is different from what the volume is actually formatted, will cause mount failure.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title6" id="parameters"><h2 class="title topictitle2" id="ariaid-title6">Parameters</h2><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d150676e168"><span>Param</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d150676e170"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d150676e168 "><span>devName</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d150676e170 "><span>The device name (name of volume) which needs to be mounted. The devName has to be preceded by the string "/dev/".</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d150676e168 "><span>mountName</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d150676e170 "><span>Mount name for the device to be mounted. This is a name provided by the user. In future, while accessing the mounted volume (say, during SYS_FS_FileOpen operation), the mountName is used to refer the path for file. The mount name has to be preceded by the string "/mnt/"</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d150676e168 "><span>filesystemtype</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d150676e170 "><span>Native file system of SYS_FS_FILE_SYSTEM_TYPE type.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d150676e168 "><span>mountflags</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d150676e170 "><span>Mounting control flags. This parameter is reserved for future enhancements. Therefore, always pass zero.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d150676e168 "><span>data</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d150676e170 "><span>The data argument is interpreted by the different file systems. This parameter is reserved for future enhancements. Therefore, always pass NULL.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title7" id="returns"><h2 class="title topictitle2" id="ariaid-title7">Returns</h2><div class="body"><p class="p"><em class="ph i">SYS_FS_RES_SUCCESS</em> - Mount was successful.</p>
<p class="p"><em class="ph i">SYS_FS_RES_FAILURE</em> - Mount was unsuccessful. The reason for the failure
can be retrieved with SYS_FS_Error.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title8" id="example"><h2 class="title topictitle2" id="ariaid-title8">Example</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d150676e214', this);">Copy</button><code id="d150676e214" content="switch(appState)&#xA;{&#xA;    case TRY_MOUNT:&#xA;    {&#xA;        if(SYS_FS_Mount(&#34;/dev/mmcblka1&#34;, &#34;/mnt/myDrive&#34;, FAT, 0, NULL) != SYS_FS_RES_SUCCESS)&#xA;        {&#xA;            // Failure, try mounting again&#xA;        }&#xA;        else&#xA;        {&#xA;            // Mount was successful. Check for File System&#xA;&#xA;            if (SYS_FS_Error() == SYS_FS_ERROR_NO_FILESYSTEM)&#xA;            {&#xA;                //Perform Driver Format operation as there is no filesystem on media&#xA;                SYS_FS_DriveFormat(...);&#xA;            }&#xA;&#xA;            appState = DO_FURTHER_STUFFS;&#xA;        }&#xA;    }&#xA;    break;&#xA;}"><span class="ph token keyword">switch</span><span class="ph token punctuation">(</span>appState<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token keyword">case</span> TRY_MOUNT<span class="ph token operator">:</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">SYS_FS_Mount</span><span class="ph token punctuation">(</span><span class="ph token string">"/dev/mmcblka1"</span><span class="ph token punctuation">,</span> <span class="ph token string">"/mnt/myDrive"</span><span class="ph token punctuation">,</span> FAT<span class="ph token punctuation">,</span> <span class="ph token number">0</span><span class="ph token punctuation">,</span> <span class="ph token constant">NULL</span><span class="ph token punctuation">)</span> <span class="ph token operator">!=</span> SYS_FS_RES_SUCCESS<span class="ph token punctuation">)</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token comment">// Failure, try mounting again</span>
        <span class="ph token punctuation">}</span>
        <span class="ph token keyword">else</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token comment">// Mount was successful. Check for File System</span>

            <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token function">SYS_FS_Error</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> SYS_FS_ERROR_NO_FILESYSTEM<span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                <span class="ph token comment">//Perform Driver Format operation as there is no filesystem on media</span>
                <span class="ph token function">SYS_FS_DriveFormat</span><span class="ph token punctuation">(</span><span class="ph token punctuation">.</span><span class="ph token punctuation">.</span><span class="ph token punctuation">.</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>

            appState <span class="ph token operator">=</span> DO_FURTHER_STUFFS<span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>
    <span class="ph token punctuation">}</span>
    <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
<span class="ph token punctuation">}</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title9" id="remarks"><h2 class="title topictitle2" id="ariaid-title9">Remarks</h2><div class="body"><p class="p">None</p>
</div>
</div>
</body>
</html>