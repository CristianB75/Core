<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="SYS_FS_DriveFormat Function" />
<meta name="DC.relation" scheme="URI" content="GUID-42556FDF-A632-49FE-8A5E-9303A926578C.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="sys-fs-driveformat-function" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>SYS_FS_DriveFormat Function</title>
<meta name="Microsoft.Help.Id" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF-sys-fs-driveformat-function" />
<meta name="Microsoft.Help.TocParent" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Core Library Reference A 11/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-F724EC87-6DF5-4689-821F-2757C4994DA9"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="sys-fs-driveformat-function">
<h1 class="title topictitle1" id="ariaid-title1">SYS_FS_DriveFormat Function</h1><div class="body"></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-42556FDF-A632-49FE-8A5E-9303A926578C.html">Library Interface</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d32997e21', this);">Copy</button><code id="d32997e21" content="SYS_FS_RESULT SYS_FS_DriveFormat&#xA;(&#xA;    const char *drive,&#xA;    const SYS_FS_FORMAT_PARAM *opt,&#xA;    void* work,&#xA;    uint32_t len&#xA;);">SYS_FS_RESULT SYS_FS_DriveFormat
<span class="ph token punctuation">(</span>
    <span class="ph token keyword">const</span> <span class="ph token keyword">char</span> <span class="ph token operator">*</span>drive<span class="ph token punctuation">,</span>
    <span class="ph token keyword">const</span> SYS_FS_FORMAT_PARAM <span class="ph token operator">*</span>opt<span class="ph token punctuation">,</span>
    <span class="ph token keyword">void</span><span class="ph token operator">*</span> work<span class="ph token punctuation">,</span>
    uint32_t len
<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="summary"><h2 class="title topictitle2" id="ariaid-title3">Summary</h2><div class="body"><p class="p">Formats a drive.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="description"><h2 class="title topictitle2" id="ariaid-title4">Description</h2><div class="body"><p class="p">This function formats a logic drive (create a FAT file system on the
logical drive), as per the format specified.</p>
<p class="p">If the logical drive that has to be formatted has been bound to any
partition (1-4) by multiple partition feature, the FAT volume is created
into the specified partition. The physical drive must have been partitioned
prior to using this function.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="precondition"><h2 class="title topictitle2" id="ariaid-title5">Precondition</h2><div class="body"><p class="p">At least one disk must be mounted. The physical drive must have already been partitioned.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title6" id="parameters"><h2 class="title topictitle2" id="ariaid-title6">Parameters</h2><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d32997e91"><span>Param</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d32997e93"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d32997e91 "><span>drive</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d32997e93 "><span>Pointer to buffer which will hold the name of drive being for which the format is to be done. If this string is NULL, then then current drive will be formatted. It is important to end the drive name with a "/".</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d32997e91 "><span>opt</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d32997e93 "><span>Specifies the structure holding format options. If a null pointer is given, fat code gives the function all options in default value</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d32997e91 "><span>work</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d32997e93 "><span>Pointer to the working buffer used for the format process.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d32997e91 "><span>len</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d32997e93 "><span>Size of the working buffer in unit of byte. It needs to be the sector size of the corresponding physical drive at least. Plenty of working buffer reduces number of write transactions to the drive and the format process will finish quickly.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title7" id="returns"><h2 class="title topictitle2" id="ariaid-title7">Returns</h2><div class="body"><p class="p"><em class="ph i">SYS_FS_RES_SUCCESS</em> - Drive format was successful.</p>
<p class="p"><em class="ph i">SYS_FS_RES_FAILURE</em> - Drive format was unsucessful. The reason for the
failure can be retrieved with SYS_FS_Error.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title8" id="example"><h2 class="title topictitle2" id="ariaid-title8">Example</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d32997e132', this);">Copy</button><code id="d32997e132" content="SYS_FS_RESULT res;&#xA;SYS_FS_FORMAT_PARAM opt = { 0 };&#xA;uint8_t CACHE_ALIGN work[512];&#xA;&#xA;switch(appState)&#xA;{&#xA;    case TRY_MOUNT:&#xA;    {&#xA;        if(SYS_FS_Mount(&#34;/dev/mmcblka1&#34;, &#34;/mnt/myDrive&#34;, FAT, 0, NULL) != SYS_FS_RES_SUCCESS)&#xA;        {&#xA;            // Failure, try mounting again&#xA;        }&#xA;        else&#xA;        {&#xA;            // Mount was successful. Format now.&#xA;            if (SYS_FS_Error() == SYS_FS_ERROR_NO_FILESYSTEM)&#xA;            {&#xA;                appState = FORMAT_DRIVE;&#xA;            }&#xA;            else&#xA;            {&#xA;                appState = OTHER_TASK;&#xA;            }&#xA;        }&#xA;        break;&#xA;    }&#xA;&#xA;    case FORMAT_DRIVE:&#xA;    {&#xA;        opt.fmt = SYS_FS_FORMAT_FAT;&#xA;        opt.au_size = 0;&#xA;&#xA;        res = SYS_FS_DriveFormat(&#34;/mnt/myDrive&#34;, &amp;opt, (void *)work, 512);&#xA;        if(res == SYS_FS_RES_FAILURE)&#xA;        {&#xA;            // Format of the drive failed.&#xA;        }&#xA;        break;&#xA;    }&#xA;}">SYS_FS_RESULT res<span class="ph token punctuation">;</span>
SYS_FS_FORMAT_PARAM opt <span class="ph token operator">=</span> <span class="ph token punctuation">{</span> <span class="ph token number">0</span> <span class="ph token punctuation">}</span><span class="ph token punctuation">;</span>
uint8_t CACHE_ALIGN work<span class="ph token punctuation">[</span><span class="ph token number">512</span><span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">switch</span><span class="ph token punctuation">(</span>appState<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token keyword">case</span> TRY_MOUNT<span class="ph token operator">:</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token keyword">if</span><span class="ph token punctuation">(</span><span class="ph token function">SYS_FS_Mount</span><span class="ph token punctuation">(</span><span class="ph token string">"/dev/mmcblka1"</span><span class="ph token punctuation">,</span> <span class="ph token string">"/mnt/myDrive"</span><span class="ph token punctuation">,</span> FAT<span class="ph token punctuation">,</span> <span class="ph token number">0</span><span class="ph token punctuation">,</span> <span class="ph token constant">NULL</span><span class="ph token punctuation">)</span> <span class="ph token operator">!=</span> SYS_FS_RES_SUCCESS<span class="ph token punctuation">)</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token comment">// Failure, try mounting again</span>
        <span class="ph token punctuation">}</span>
        <span class="ph token keyword">else</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token comment">// Mount was successful. Format now.</span>
            <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token function">SYS_FS_Error</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span> <span class="ph token operator">==</span> SYS_FS_ERROR_NO_FILESYSTEM<span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                appState <span class="ph token operator">=</span> FORMAT_DRIVE<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">else</span>
            <span class="ph token punctuation">{</span>
                appState <span class="ph token operator">=</span> OTHER_TASK<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
        <span class="ph token punctuation">}</span>
        <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
    <span class="ph token punctuation">}</span>

    <span class="ph token keyword">case</span> FORMAT_DRIVE<span class="ph token operator">:</span>
    <span class="ph token punctuation">{</span>
        opt<span class="ph token punctuation">.</span>fmt <span class="ph token operator">=</span> SYS_FS_FORMAT_FAT<span class="ph token punctuation">;</span>
        opt<span class="ph token punctuation">.</span>au_size <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

        res <span class="ph token operator">=</span> <span class="ph token function">SYS_FS_DriveFormat</span><span class="ph token punctuation">(</span><span class="ph token string">"/mnt/myDrive"</span><span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>opt<span class="ph token punctuation">,</span> <span class="ph token punctuation">(</span><span class="ph token keyword">void</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span>work<span class="ph token punctuation">,</span> <span class="ph token number">512</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
        <span class="ph token keyword">if</span><span class="ph token punctuation">(</span>res <span class="ph token operator">==</span> SYS_FS_RES_FAILURE<span class="ph token punctuation">)</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token comment">// Format of the drive failed.</span>
        <span class="ph token punctuation">}</span>
        <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
    <span class="ph token punctuation">}</span>
<span class="ph token punctuation">}</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title9" id="remarks"><h2 class="title topictitle2" id="ariaid-title9">Remarks</h2><div class="body"><p class="p">None.</p>
</div>
</div>
</body>
</html>