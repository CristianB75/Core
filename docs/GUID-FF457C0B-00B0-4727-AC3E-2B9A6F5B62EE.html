<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="Using The Library" />
<meta name="DC.relation" scheme="URI" content="GUID-89A8332D-B4D0-4989-8602-EACDE3EE74AC.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="using-the-library" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>Using The Library</title>
<meta name="Microsoft.Help.Id" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF-using-the-library" />
<meta name="Microsoft.Help.TocParent" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Core Library Reference A 11/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-FF457C0B-00B0-4727-AC3E-2B9A6F5B62EE"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="using-the-library">
<h1 class="title topictitle1" id="ariaid-title1">Using The Library</h1><div class="body"><p class="p">The SDSPI driver builds on top of the SPI PLIB or SPI Driver and provides direct access to the SD Card. It also confirms to the media block layer interface which allows it to register its services with the file system's media block driver interface.</p>
<p class="p"><strong class="ph b">Modes supported:</strong></p>
<ul class="ul"><li class="li"><p class="p">Asynchronous mode : Supported in both Bare-metal and RTOS environment</p>
</li>
<li class="li"><p class="p">Synchronous mode : Supported in RTOS environment</p>
</li>
</ul>
<p class="p"><strong class="ph b">Usage Methods</strong></p>
<ul class="ul"><li class="li"><p class="p">Application can directly use the SDSPI driver API's to perform Read/Write operations.</p>
</li>
<li class="li"><p class="p">Application can use File System service layer and perform file operations on the SD/eMMC Card.</p>
</li>
<li class="li"><p class="p">It can be interfaced with Middleware's like USB.</p>
</li>
</ul>
<p class="p"><strong class="ph b">Example application to Write and Read SD Card in Synchronous mode</strong></p>
<pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d67553e38', this);">Copy</button><code id="d67553e38" content="/* Write and Read 60KB of Data */&#xA;#define SDSPI_DATA_SIZE              (10240U)&#xA;#define SDSPI_BUFFER_SIZE            (SDSPI_DATA_SIZE / sizeof(uint32_t))&#xA;&#xA;#define GEOMETRY_TABLE_READ_ENTRY   (0)&#xA;#define GEOMETRY_TABLE_WRITE_ENTRY  (1)&#xA;#define GEOMETRY_TABLE_ERASE_ENTRY  (2)&#xA;&#xA;#define BLOCK_START                 0x2000&#xA;&#xA;SYS_MEDIA_GEOMETRY *geometry = NULL;&#xA;&#xA;APP_DATA appData;&#xA;&#xA;/* Read Buffer */&#xA;static CACHE_ALIGN uint32_t readBuffer[SDSPI_BUFFER_SIZE];&#xA;&#xA;/* Write Buffer*/&#xA;static CACHE_ALIGN uint32_t writeBuffer[SDSPI_BUFFER_SIZE];&#xA;&#xA;void APP_Initialize ( void )&#xA;{&#xA;    uint32_t i = 0;&#xA;&#xA;    /* Place the App state machine in its initial state. */&#xA;    appData.state = APP_STATE_OPEN_DRIVER;&#xA;&#xA;    for (i = 0; i &lt; SDSPI_BUFFER_SIZE; i++)&#xA;    {&#xA;        writeBuffer[i] = i;&#xA;    }&#xA;}&#xA;&#xA;void APP_Tasks ( void )&#xA;{&#xA;    /* Check the application's current state. */&#xA;    switch ( appData.state )&#xA;    {&#xA;        case APP_STATE_OPEN_DRIVER:&#xA;        {&#xA;            appData.sdspiHandle = DRV_SDSPI_Open(DRV_SDSPI_INDEX_0, DRV_IO_INTENT_READWRITE);&#xA;&#xA;            if (appData.sdspiHandle != DRV_HANDLE_INVALID)&#xA;            {&#xA;                appData.state = APP_STATE_WAIT_FOR_SDCARD_ATTACH;&#xA;            }&#xA;            break;&#xA;        }&#xA;&#xA;        case APP_STATE_WAIT_FOR_SDCARD_ATTACH:&#xA;        {&#xA;            if (DRV_SDSPI_IsAttached(appData.sdspiHandle) == true)&#xA;            {&#xA;                appData.state = APP_STATE_GEOMETRY_GET;&#xA;            }&#xA;            break;&#xA;        }&#xA;&#xA;        case APP_STATE_GEOMETRY_GET:&#xA;        {&#xA;            geometry = DRV_SDSPI_GeometryGet(appData.sdspiHandle);&#xA;&#xA;            if (geometry != NULL)&#xA;            {&#xA;                appData.numReadBlocks  = (SDSPI_DATA_SIZE / geometry-&gt;geometryTable[GEOMETRY_TABLE_READ_ENTRY].blockSize);&#xA;                appData.numWriteBlocks = (SDSPI_DATA_SIZE / geometry-&gt;geometryTable[GEOMETRY_TABLE_WRITE_ENTRY].blockSize);&#xA;                appData.numEraseBlocks = (SDSPI_DATA_SIZE / geometry-&gt;geometryTable[GEOMETRY_TABLE_ERASE_ENTRY].blockSize);&#xA;                appData.state = APP_STATE_WRITE_MEMORY;&#xA;            }&#xA;            else&#xA;            {&#xA;                appData.state = APP_STATE_ERROR;&#xA;            }&#xA;            break;&#xA;        }&#xA;&#xA;        case APP_STATE_WRITE_MEMORY:&#xA;        {&#xA;            if (DRV_SDSPI_SyncWrite(appData.sdspiHandle, (void *)writeBuffer, BLOCK_START, appData.numWriteBlocks) == true)&#xA;            {&#xA;                appData.state = APP_STATE_READ_MEMORY;&#xA;            }&#xA;            else&#xA;            {&#xA;                appData.state = APP_STATE_ERROR;&#xA;            }&#xA;&#xA;            break;&#xA;        }&#xA;&#xA;        case APP_STATE_READ_MEMORY:&#xA;        {&#xA;            memset((void *)readBuffer, 0, SDSPI_DATA_SIZE);&#xA;&#xA;            if (DRV_SDSPI_SyncRead(appData.sdspiHandle, (void *)readBuffer, BLOCK_START, appData.numReadBlocks) == true)&#xA;            {&#xA;                appData.state = APP_STATE_VERIFY_DATA;&#xA;            }&#xA;            else&#xA;            {&#xA;                appData.state = APP_STATE_ERROR;&#xA;            }&#xA;&#xA;            break;&#xA;        }&#xA;&#xA;        case APP_STATE_VERIFY_DATA:&#xA;        {&#xA;            if (!memcmp(writeBuffer, readBuffer, SDSPI_DATA_SIZE))&#xA;            {&#xA;                appData.state = APP_STATE_SUCCESS;&#xA;            }&#xA;            else&#xA;            {&#xA;                appData.state = APP_STATE_ERROR;&#xA;            }&#xA;            DRV_SDSPI_Close(appData.sdspiHandle);&#xA;&#xA;            break;&#xA;        }&#xA;&#xA;        case APP_STATE_SUCCESS:&#xA;        {&#xA;            LED_ON();&#xA;            break;&#xA;        }&#xA;&#xA;        case APP_STATE_ERROR:&#xA;        default:&#xA;        {&#xA;            LED_OFF();&#xA;            break;&#xA;        }&#xA;    }&#xA;}"><span class="ph token comment">/* Write and Read 60KB of Data */</span>
<span class="ph token macro property">#<span class="ph token directive keyword">define</span> SDSPI_DATA_SIZE              (10240U)</span>
<span class="ph token macro property">#<span class="ph token directive keyword">define</span> SDSPI_BUFFER_SIZE            (SDSPI_DATA_SIZE / sizeof(uint32_t))</span>

<span class="ph token macro property">#<span class="ph token directive keyword">define</span> GEOMETRY_TABLE_READ_ENTRY   (0)</span>
<span class="ph token macro property">#<span class="ph token directive keyword">define</span> GEOMETRY_TABLE_WRITE_ENTRY  (1)</span>
<span class="ph token macro property">#<span class="ph token directive keyword">define</span> GEOMETRY_TABLE_ERASE_ENTRY  (2)</span>

<span class="ph token macro property">#<span class="ph token directive keyword">define</span> BLOCK_START                 0x2000</span>

SYS_MEDIA_GEOMETRY <span class="ph token operator">*</span>geometry <span class="ph token operator">=</span> <span class="ph token constant">NULL</span><span class="ph token punctuation">;</span>

APP_DATA appData<span class="ph token punctuation">;</span>

<span class="ph token comment">/* Read Buffer */</span>
<span class="ph token keyword">static</span> CACHE_ALIGN uint32_t readBuffer<span class="ph token punctuation">[</span>SDSPI_BUFFER_SIZE<span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>

<span class="ph token comment">/* Write Buffer*/</span>
<span class="ph token keyword">static</span> CACHE_ALIGN uint32_t writeBuffer<span class="ph token punctuation">[</span>SDSPI_BUFFER_SIZE<span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">void</span> APP_Initialize <span class="ph token punctuation">(</span> <span class="ph token keyword">void</span> <span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    uint32_t i <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span>

    <span class="ph token comment">/* Place the App state machine in its initial state. */</span>
    appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_OPEN_DRIVER<span class="ph token punctuation">;</span>

    <span class="ph token keyword">for</span> <span class="ph token punctuation">(</span>i <span class="ph token operator">=</span> <span class="ph token number">0</span><span class="ph token punctuation">;</span> i <span class="ph token operator">&lt;</span> SDSPI_BUFFER_SIZE<span class="ph token punctuation">;</span> i<span class="ph token operator">++</span><span class="ph token punctuation">)</span>
    <span class="ph token punctuation">{</span>
        writeBuffer<span class="ph token punctuation">[</span>i<span class="ph token punctuation">]</span> <span class="ph token operator">=</span> i<span class="ph token punctuation">;</span>
    <span class="ph token punctuation">}</span>
<span class="ph token punctuation">}</span>

<span class="ph token keyword">void</span> APP_Tasks <span class="ph token punctuation">(</span> <span class="ph token keyword">void</span> <span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">/* Check the application's current state. */</span>
    <span class="ph token keyword">switch</span> <span class="ph token punctuation">(</span> appData<span class="ph token punctuation">.</span>state <span class="ph token punctuation">)</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token keyword">case</span> APP_STATE_OPEN_DRIVER<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            appData<span class="ph token punctuation">.</span>sdspiHandle <span class="ph token operator">=</span> <span class="ph token function">DRV_SDSPI_Open</span><span class="ph token punctuation">(</span>DRV_SDSPI_INDEX_0<span class="ph token punctuation">,</span> DRV_IO_INTENT_READWRITE<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

            <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span>appData<span class="ph token punctuation">.</span>sdspiHandle <span class="ph token operator">!=</span> DRV_HANDLE_INVALID<span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_WAIT_FOR_SDCARD_ATTACH<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>

        <span class="ph token keyword">case</span> APP_STATE_WAIT_FOR_SDCARD_ATTACH<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token function">DRV_SDSPI_IsAttached</span><span class="ph token punctuation">(</span>appData<span class="ph token punctuation">.</span>sdspiHandle<span class="ph token punctuation">)</span> <span class="ph token operator">==</span> true<span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_GEOMETRY_GET<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>

        <span class="ph token keyword">case</span> APP_STATE_GEOMETRY_GET<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            geometry <span class="ph token operator">=</span> <span class="ph token function">DRV_SDSPI_GeometryGet</span><span class="ph token punctuation">(</span>appData<span class="ph token punctuation">.</span>sdspiHandle<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

            <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span>geometry <span class="ph token operator">!=</span> <span class="ph token constant">NULL</span><span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                appData<span class="ph token punctuation">.</span>numReadBlocks  <span class="ph token operator">=</span> <span class="ph token punctuation">(</span>SDSPI_DATA_SIZE <span class="ph token operator">/</span> geometry<span class="ph token operator">-&gt;</span>geometryTable<span class="ph token punctuation">[</span>GEOMETRY_TABLE_READ_ENTRY<span class="ph token punctuation">]</span><span class="ph token punctuation">.</span>blockSize<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
                appData<span class="ph token punctuation">.</span>numWriteBlocks <span class="ph token operator">=</span> <span class="ph token punctuation">(</span>SDSPI_DATA_SIZE <span class="ph token operator">/</span> geometry<span class="ph token operator">-&gt;</span>geometryTable<span class="ph token punctuation">[</span>GEOMETRY_TABLE_WRITE_ENTRY<span class="ph token punctuation">]</span><span class="ph token punctuation">.</span>blockSize<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
                appData<span class="ph token punctuation">.</span>numEraseBlocks <span class="ph token operator">=</span> <span class="ph token punctuation">(</span>SDSPI_DATA_SIZE <span class="ph token operator">/</span> geometry<span class="ph token operator">-&gt;</span>geometryTable<span class="ph token punctuation">[</span>GEOMETRY_TABLE_ERASE_ENTRY<span class="ph token punctuation">]</span><span class="ph token punctuation">.</span>blockSize<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
                appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_WRITE_MEMORY<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">else</span>
            <span class="ph token punctuation">{</span>
                appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_ERROR<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>

        <span class="ph token keyword">case</span> APP_STATE_WRITE_MEMORY<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token function">DRV_SDSPI_SyncWrite</span><span class="ph token punctuation">(</span>appData<span class="ph token punctuation">.</span>sdspiHandle<span class="ph token punctuation">,</span> <span class="ph token punctuation">(</span><span class="ph token keyword">void</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span>writeBuffer<span class="ph token punctuation">,</span> BLOCK_START<span class="ph token punctuation">,</span> appData<span class="ph token punctuation">.</span>numWriteBlocks<span class="ph token punctuation">)</span> <span class="ph token operator">==</span> true<span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_READ_MEMORY<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">else</span>
            <span class="ph token punctuation">{</span>
                appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_ERROR<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>

            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>

        <span class="ph token keyword">case</span> APP_STATE_READ_MEMORY<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token function">memset</span><span class="ph token punctuation">(</span><span class="ph token punctuation">(</span><span class="ph token keyword">void</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span>readBuffer<span class="ph token punctuation">,</span> <span class="ph token number">0</span><span class="ph token punctuation">,</span> SDSPI_DATA_SIZE<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

            <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token function">DRV_SDSPI_SyncRead</span><span class="ph token punctuation">(</span>appData<span class="ph token punctuation">.</span>sdspiHandle<span class="ph token punctuation">,</span> <span class="ph token punctuation">(</span><span class="ph token keyword">void</span> <span class="ph token operator">*</span><span class="ph token punctuation">)</span>readBuffer<span class="ph token punctuation">,</span> BLOCK_START<span class="ph token punctuation">,</span> appData<span class="ph token punctuation">.</span>numReadBlocks<span class="ph token punctuation">)</span> <span class="ph token operator">==</span> true<span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_VERIFY_DATA<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">else</span>
            <span class="ph token punctuation">{</span>
                appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_ERROR<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>

            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>

        <span class="ph token keyword">case</span> APP_STATE_VERIFY_DATA<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token keyword">if</span> <span class="ph token punctuation">(</span><span class="ph token operator">!</span><span class="ph token function">memcmp</span><span class="ph token punctuation">(</span>writeBuffer<span class="ph token punctuation">,</span> readBuffer<span class="ph token punctuation">,</span> SDSPI_DATA_SIZE<span class="ph token punctuation">)</span><span class="ph token punctuation">)</span>
            <span class="ph token punctuation">{</span>
                appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_SUCCESS<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token keyword">else</span>
            <span class="ph token punctuation">{</span>
                appData<span class="ph token punctuation">.</span>state <span class="ph token operator">=</span> APP_STATE_ERROR<span class="ph token punctuation">;</span>
            <span class="ph token punctuation">}</span>
            <span class="ph token function">DRV_SDSPI_Close</span><span class="ph token punctuation">(</span>appData<span class="ph token punctuation">.</span>sdspiHandle<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>

        <span class="ph token keyword">case</span> APP_STATE_SUCCESS<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token function">LED_ON</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>

        <span class="ph token keyword">case</span> APP_STATE_ERROR<span class="ph token operator">:</span>
        <span class="ph token keyword">default</span><span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token function">LED_OFF</span><span class="ph token punctuation">(</span><span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>
    <span class="ph token punctuation">}</span>
<span class="ph token punctuation">}</span></code></pre></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-89A8332D-B4D0-4989-8602-EACDE3EE74AC.html">SDSPI Driver</a></div>
</div>
</div></body>
</html>