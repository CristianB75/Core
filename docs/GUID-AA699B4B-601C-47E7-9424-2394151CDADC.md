# DRV\_SDMMC\_AsyncWrite Function

**Parent topic:**[Library Interface](GUID-D15D1321-065D-4EA7-A00C-D277A8A66F8D.md)

## C

```c
void DRV_SDMMC_AsyncWrite (
    const DRV_HANDLE handle,
    DRV_SDMMC_COMMAND_HANDLE* commandHandle,
    void* sourceBuffer,
    uint32_t blockStart,
    uint32_t nBlock
);
```

## Summary

Writes blocks of data starting at the specified address of the SD Card.

## Description

This function schedules a non-blocking write operation for writing blocks<br />of data to the SD Card. The function returns with a valid buffer handle<br />in the commandHandle argument if the write request was scheduled successfully.<br />The function adds the request to the hardware instance queue and returns<br />immediately. While the request is in the queue, the application buffer is<br />owned by the driver and should not be modified. The function returns<br />DRV\_SDMMC\_COMMAND\_HANDLE\_INVALID in the commandHandle argument under the<br />following circumstances:

-   if the driver handle is invalid

-   if the source buffer pointer is NULL

-   if the number of blocks to write is zero or more than the actual number of blocks available

-   if a buffer object could not be allocated to the request


If the requesting client registered an event callback with the driver, the<br />driver will issue a DRV\_SDMMC\_EVENT\_COMMAND\_COMPLETE event if the<br />buffer was processed successfully or DRV\_SDMMC\_EVENT\_COMMAND\_ERROR<br />event if the buffer was not processed successfully.

## Precondition

The DRV\_SDMMC\_Initialize routine must have been called for the specified SDMMC driver instance.

DRV\_SDMMC\_Open routine must have been called to obtain a valid opened device handle.

## Parameters

|Param|Description|
|-----|-----------|
|handle|A valid open-instance handle, returned from the driver's open function|
|commandHandle|Pointer to an argument that will contain the return buffer handle|
|sourceBuffer|The source buffer containing data to be programmed to the SD Card.|
|blockStart|Start block address of SD Card where the writes should begin.|
|nBlock|Total number of blocks to be written.|

## Returns

The buffer handle is returned in the commandHandle argument. It will be DRV\_SDMMC\_COMMAND\_HANDLE\_INVALID if the request was not successful.

## Example

```c
uint8_t CACHE_ALIGN myBuffer[MY_BUFFER_SIZE];

// address should be block aligned.
uint32_t blockStart = 0x00;
uint32_t nBlock = 2;
DRV_SDMMC_COMMAND_HANDLE commandHandle;
MY_APP_OBJ myAppObj;

// Event is received when the buffer is processed.

void APP_SDMMCEventHandler(
    DRV_SDMMC_EVENT event,
    DRV_SDMMC_COMMAND_HANDLE commandHandle,
    uintptr_t contextHandle
)
{
    // contextHandle points to myAppObj.
    
    switch(event)
    {
        case DRV_SDMMC_EVENT_COMMAND_COMPLETE:
        {
            // This means the data was transferred successfully
            break;
        }
        
        case DRV_SDMMC_EVENT_COMMAND_ERROR:
        {
            // Error handling here
            break;
        }
        
        default:
        {
            break;
        }
    }
}

// mySDMMCHandle is the handle returned
// by the DRV_SDMMC_Open function.

// Client registers an event handler with driver

DRV_SDMMC_EventHandlerSet(mySDMMCHandle, APP_SDMMCEventHandler, (uintptr_t)&myAppObj);

DRV_SDMMC_AsyncWrite(mySDMMCHandle, &commandHandle, &myBuffer[0], blockStart, nBlock);

if(commandHandle == DRV_SDMMC_COMMAND_HANDLE_INVALID)
{
    // Error handling here
}

```

## Remarks

None.

