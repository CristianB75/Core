<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="DRV_SDSPI_AsyncRead Function" />
<meta name="DC.relation" scheme="URI" content="GUID-7A1B4F41-7CC6-49CF-941E-25265059D247.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="drv-sdspi-asyncread-function" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>DRV_SDSPI_AsyncRead Function</title>
<meta name="Microsoft.Help.Id" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF-drv-sdspi-asyncread-function" />
<meta name="Microsoft.Help.TocParent" content="GUID-EDFB1AB8-CD6B-446F-8E25-F2167287A1AF" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony Core Library Reference A 11/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-DD0C5C28-401A-4FD6-9BA8-1EDD0812FE8C"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="drv-sdspi-asyncread-function">
<h1 class="title topictitle1" id="ariaid-title1">DRV_SDSPI_AsyncRead Function</h1><div class="body"></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-7A1B4F41-7CC6-49CF-941E-25265059D247.html">Library Interface</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d187490e21', this);">Copy</button><code id="d187490e21" content="void DRV_SDSPI_AsyncRead (&#xA;    const DRV_HANDLE handle,&#xA;    DRV_SDSPI_COMMAND_HANDLE* commandHandle,&#xA;    void* targetBuffer,&#xA;    uint32_t blockStart,&#xA;    uint32_t nBlocks&#xA;)"><span class="ph token keyword">void</span> DRV_SDSPI_AsyncRead <span class="ph token punctuation">(</span>
    <span class="ph token keyword">const</span> DRV_HANDLE handle<span class="ph token punctuation">,</span>
    DRV_SDSPI_COMMAND_HANDLE<span class="ph token operator">*</span> commandHandle<span class="ph token punctuation">,</span>
    <span class="ph token keyword">void</span><span class="ph token operator">*</span> targetBuffer<span class="ph token punctuation">,</span>
    uint32_t blockStart<span class="ph token punctuation">,</span>
    uint32_t nBlocks
<span class="ph token punctuation">)</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="summary"><h2 class="title topictitle2" id="ariaid-title3">Summary</h2><div class="body"><p class="p">Reads blocks of data from the specified block address of the SD Card.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="description"><h2 class="title topictitle2" id="ariaid-title4">Description</h2><div class="body"><p class="p">This function schedules a non-blocking read operation for reading blocks
of data from the SD Card. The function returns with a valid buffer handle
in the commandHandle argument if the read request was scheduled successfully.
The function adds the request to the hardware instance queue and returns
immediately. While the request is in the queue, the application buffer is
owned by the driver and should not be modified. The function returns
DRV_SDSPI_COMMAND_HANDLE_INVALID in the commandHandle argument under the
following circumstances:</p>
<ul class="ul"><li class="li"><p class="p">if the driver handle is invalid</p>
</li>
<li class="li"><p class="p">if the target buffer pointer is NULL</p>
</li>
<li class="li"><p class="p">if the number of blocks to be read is zero or more than the actual number of blocks available.</p>
</li>
<li class="li"><p class="p">Error during the read operation</p>
</li>
</ul>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="precondition"><h2 class="title topictitle2" id="ariaid-title5">Precondition</h2><div class="body"><p class="p">The DRV_SDSPI_Initialize routine must have been called for the specified SDSPI driver instance.</p>
<p class="p">DRV_SDSPI_Open must have been called to obtain a valid opened device handle.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title6" id="parameters"><h2 class="title topictitle2" id="ariaid-title6">Parameters</h2><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d187490e97"><span>Param</span></th>
<th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d187490e99"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d187490e97 "><span>handle</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d187490e99 "><span>A valid open-instance handle, returned from the driver's open function</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d187490e97 "><span>commandHandle</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d187490e99 "><span>Pointer to an argument that will contain the return buffer handle</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d187490e97 "><span>targetBuffer</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d187490e99 "><span>Buffer into which the data read from the SD Card will be placed</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d187490e97 "><span>blockStart</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d187490e99 "><span>Starting block address of the SD Card from where the read should begin.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d187490e97 "><span>nBlock</span></td>
<td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d187490e99 "><span>Total number of blocks to be read.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title7" id="returns"><h2 class="title topictitle2" id="ariaid-title7">Returns</h2><div class="body"><p class="p">The buffer handle is returned in the commandHandle argument. It will be DRV_SDSPI_COMMAND_HANDLE_INVALID if the request was not successful.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title8" id="example"><h2 class="title topictitle2" id="ariaid-title8">Example</h2><div class="body"><pre class="pre codeblock language-c"><button title="Copy Code" class="copy-code" onclick="cpy('d187490e137', this);">Copy</button><code id="d187490e137" content="uint8_t CACHE_ALIGN myBuffer[MY_BUFFER_SIZE];&#xA;&#xA;// address should be block aligned.&#xA;uint32_t blockStart = 0x00;&#xA;uint32_t nBlock = 2;&#xA;DRV_SDSPI_COMMAND_HANDLE commandHandle;&#xA;MY_APP_OBJ myAppObj;&#xA;&#xA;// Event is received when&#xA;// the buffer is processed.&#xA;&#xA;void APP_SDSPIEventHandler(&#xA;    DRV_SDSPI_EVENT event,&#xA;    DRV_SDSPI_COMMAND_HANDLE commandHandle,&#xA;    uintptr_t contextHandle&#xA;)&#xA;{&#xA;    // contextHandle points to myAppObj.&#xA;    &#xA;    switch(event)&#xA;    {&#xA;        case DRV_SDSPI_EVENT_COMMAND_COMPLETE:&#xA;        {&#xA;            // This means the data was transferred successfully&#xA;            break;&#xA;        }&#xA;        &#xA;        case DRV_SDSPI_EVENT_COMMAND_ERROR:&#xA;        {&#xA;            // Error handling here&#xA;            break;&#xA;        }&#xA;        &#xA;        default:&#xA;        {&#xA;            break;&#xA;        }&#xA;    }&#xA;}&#xA;&#xA;// mySDSPIHandle is the handle returned&#xA;// by the DRV_SDSPI_Open function.&#xA;&#xA;// Client registers an event handler with driver&#xA;DRV_SDSPI_EventHandlerSet(mySDSPIHandle, APP_SDSPIEventHandler, (uintptr_t)&amp;myAppObj);&#xA;&#xA;DRV_SDSPI_AsyncRead(mySDSPIHandle, &amp;commandHandle, &amp;myBuffer[0], blockStart, nBlock);&#xA;&#xA;if(commandHandle == DRV_SDMMC_COMMAND_HANDLE_INVALID)&#xA;{&#xA;    // Error handling here&#xA;}&#xA;else&#xA;{&#xA;    // Read Successfully queued&#xA;}">uint8_t CACHE_ALIGN myBuffer<span class="ph token punctuation">[</span>MY_BUFFER_SIZE<span class="ph token punctuation">]</span><span class="ph token punctuation">;</span>

<span class="ph token comment">// address should be block aligned.</span>
uint32_t blockStart <span class="ph token operator">=</span> <span class="ph token number">0x00</span><span class="ph token punctuation">;</span>
uint32_t nBlock <span class="ph token operator">=</span> <span class="ph token number">2</span><span class="ph token punctuation">;</span>
DRV_SDSPI_COMMAND_HANDLE commandHandle<span class="ph token punctuation">;</span>
MY_APP_OBJ myAppObj<span class="ph token punctuation">;</span>

<span class="ph token comment">// Event is received when</span>
<span class="ph token comment">// the buffer is processed.</span>

<span class="ph token keyword">void</span> <span class="ph token function">APP_SDSPIEventHandler</span><span class="ph token punctuation">(</span>
    DRV_SDSPI_EVENT event<span class="ph token punctuation">,</span>
    DRV_SDSPI_COMMAND_HANDLE commandHandle<span class="ph token punctuation">,</span>
    uintptr_t contextHandle
<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// contextHandle points to myAppObj.</span>
    
    <span class="ph token keyword">switch</span><span class="ph token punctuation">(</span>event<span class="ph token punctuation">)</span>
    <span class="ph token punctuation">{</span>
        <span class="ph token keyword">case</span> DRV_SDSPI_EVENT_COMMAND_COMPLETE<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token comment">// This means the data was transferred successfully</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>
        
        <span class="ph token keyword">case</span> DRV_SDSPI_EVENT_COMMAND_ERROR<span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token comment">// Error handling here</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>
        
        <span class="ph token keyword">default</span><span class="ph token operator">:</span>
        <span class="ph token punctuation">{</span>
            <span class="ph token keyword">break</span><span class="ph token punctuation">;</span>
        <span class="ph token punctuation">}</span>
    <span class="ph token punctuation">}</span>
<span class="ph token punctuation">}</span>

<span class="ph token comment">// mySDSPIHandle is the handle returned</span>
<span class="ph token comment">// by the DRV_SDSPI_Open function.</span>

<span class="ph token comment">// Client registers an event handler with driver</span>
<span class="ph token function">DRV_SDSPI_EventHandlerSet</span><span class="ph token punctuation">(</span>mySDSPIHandle<span class="ph token punctuation">,</span> APP_SDSPIEventHandler<span class="ph token punctuation">,</span> <span class="ph token punctuation">(</span>uintptr_t<span class="ph token punctuation">)</span><span class="ph token operator">&amp;</span>myAppObj<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token function">DRV_SDSPI_AsyncRead</span><span class="ph token punctuation">(</span>mySDSPIHandle<span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>commandHandle<span class="ph token punctuation">,</span> <span class="ph token operator">&amp;</span>myBuffer<span class="ph token punctuation">[</span><span class="ph token number">0</span><span class="ph token punctuation">]</span><span class="ph token punctuation">,</span> blockStart<span class="ph token punctuation">,</span> nBlock<span class="ph token punctuation">)</span><span class="ph token punctuation">;</span>

<span class="ph token keyword">if</span><span class="ph token punctuation">(</span>commandHandle <span class="ph token operator">==</span> DRV_SDMMC_COMMAND_HANDLE_INVALID<span class="ph token punctuation">)</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// Error handling here</span>
<span class="ph token punctuation">}</span>
<span class="ph token keyword">else</span>
<span class="ph token punctuation">{</span>
    <span class="ph token comment">// Read Successfully queued</span>
<span class="ph token punctuation">}</span></code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title9" id="remarks"><h2 class="title topictitle2" id="ariaid-title9">Remarks</h2><div class="body"><p class="p">None.</p>
</div>
</div>
</body>
</html>